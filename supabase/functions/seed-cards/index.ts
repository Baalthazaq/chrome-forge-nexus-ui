import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const corsHeaders = {
  "Access-Control-Allow-Origin": "*",
  "Access-Control-Allow-Headers": "authorization, x-client-info, apikey, content-type",
};

Deno.serve(async (req) => {
  if (req.method === "OPTIONS") return new Response(null, { headers: corsHeaders });

  try {
    const supabase = createClient(
      Deno.env.get("SUPABASE_URL")!,
      Deno.env.get("SUPABASE_SERVICE_ROLE_KEY")!
    );

    // Verify admin
    const authHeader = req.headers.get("Authorization");
    if (authHeader) {
      const token = authHeader.replace("Bearer ", "");
      const { data: { user } } = await supabase.auth.getUser(token);
      if (user) {
        const { data: role } = await supabase.rpc("get_user_role", { _user_id: user.id });
        if (role !== "admin") {
          return new Response(JSON.stringify({ error: "Admin only" }), { status: 403, headers: { ...corsHeaders, "Content-Type": "application/json" } });
        }
      }
    }

    // Clear existing cards
    await supabase.from("game_cards").delete().neq("id", "00000000-0000-0000-0000-000000000000");

    const cards: any[] = [];

    // === CLASS CARDS ===
    const classes = [
      ["Bard","Grace","Codex",10,5,"A romance novel or a letter never opened. THEN DECIDE WHAT YOU CARRY YOUR SPELLS IN: songbook, journal, etc.","MAKE A SCENE: Spend 3 Hope to temporarily Distract a target within Close range, giving them a -2 penalty to their Difficulty.","RALLY\nOnce per session, describe how you rally the party and give yourself and each of your allies a Rally Die. At level 1, your Rally Die is a d6. A PC can spend their Rally Die to roll it, adding the result to their action roll, reaction roll, damage roll, or to clear a number of Stress equal to the result. At the end of each session, clear all unspent Rally Dice.\n\nAt level 5, your Rally Die increases to a d8."],
      ["Druid","Sage","Arcana",10,6,"A small bag of rocks and bones or a strange pendant found in the dirt.","EVOLUTION: Spend 3 Hope to transform into a Beastform without marking a Stress. When you do, choose one trait to raise by +1 until you drop out of that Beastform.","BEASTFORM\nMark a Stress to magically transform into a creature of your tier or lower from the Beastform list. You can drop out of this form at any time. While transformed, you can't use weapons or cast spells from domain cards, but you can still use other features abilities you have access to.\n\nWILDTOUCH\nYou can perform harmless, subtle effects that involve nature at will."],
      ["Guardian","Valor","Blade",9,7,"A totem from your mentor or a secret key.","FRONTLINE TANK: Spend 3 Hope to clear 2 Armor Slots.","UNSTOPPABLE\nOnce per long rest, you can become Unstoppable. You gain an Unstoppable Die (d4 at level 1, d6 at level 5). While Unstoppable:\n• You reduce the severity of physical damage by one threshold.\n• You add the current value of the Unstoppable Die to your damage roll.\n• You can't be Restrained or Vulnerable."],
      ["Ranger","Bone","Sage",12,6,"A trophy from your first kill or a seemingly broken compass.","HOLD THEM OFF: Spend 3 Hope when you succeed on an attack with a weapon to use that same roll against two additional adversaries within range of the attack.","RANGER'S FOCUS\nSpend a Hope and make an attack against a target. On a success, deal your attack's normal damage and temporarily make the attack's target your Focus. Until this feature ends:\n• You know precisely what direction they are in.\n• When you deal damage to them, they must mark a Stress.\n• When you fail an attack against them, you can end your Ranger's Focus to reroll your Duality Dice."],
      ["Rogue","Midnight","Grace",12,6,"A set of forgery tools or a grappling hook.","ROGUE'S DODGE: Spend 3 Hope to gain a +2 bonus to your Evasion until the next time an attack succeeds against you. This bonus lasts until your next rest.","CLOAKED\nAny time you would be Hidden, you are instead Cloaked. In addition to the benefits of the Hidden condition, while Cloaked you remain unseen if you are stationary when an adversary moves to where they would normally see you.\n\nSNEAK ATTACK\nWhen you succeed on an attack while Cloaked or while an ally is within Melee range of your target, add a number of d6s equal to your tier to your damage roll."],
      ["Seraph","Splendor","Valor",9,7,"A bundle of offerings or a sigil of your god.","LIFE SUPPORT: Spend 3 Hope to clear a Hit Point on an ally within Close Range.","PRAYER DICE\nAt the beginning of each session, roll a number of d4s equal to your subclass's Spellcast trait and place them on your character sheet. You can spend any number of Prayer Dice to aid yourself or an ally within Far range."],
      ["Sorcerer","Arcana","Midnight",10,6,"A whispering orb or a family heirloom.","VOLATILE MAGIC: Spend 3 Hope to reroll any number of your damage dice on an attack that deals magic damage.","ARCANE SENSE\nYou can sense the presence of magical people and objects within Close range.\n\nMINOR ILLUSION\nMake a Spellcast Roll (10). On a success, you create a minor visual illusion.\n\nCHANNEL RAW POWER\nOnce per long rest, you can place a domain card from your loadout into your vault and choose to either gain Hope equal to the level of the card, or enhance a spell's damage."],
      ["Warrior","Blade","Bone",11,6,"The drawing of a lover or a sharpening stone.","NO MERCY: Spend 3 Hope to gain a +1 bonus to your attack rolls until your next rest.","ATTACK OF OPPORTUNITY\nIf an adversary within Melee range attempts to leave that range, make a reaction roll. Choose one effect on a success, or two if you critically succeed:\n• They can't move from where they are.\n• You deal damage to them equal to your primary weapon's damage.\n• You move with them.\n\nCOMBAT TRAINING\nYou ignore burden when equipping weapons. When you deal physical damage, you gain a bonus to your damage roll equal to your level."],
      ["Wizard","Codex","Splendor",11,5,"A book you're trying to translate or a tiny, harmless elemental pet.","NOT THIS TIME: Spend 3 Hope to force an adversary within Far range to reroll an attack or damage roll.","PRESTIDIGITATION\nYou can perform harmless, subtle magical effects at will.\n\nSTRANGE PATTERNS\nChoose a number between 1 and 12. When you roll that number on a Duality Die, gain a Hope or clear a Stress."],
      ["Brawler","Bone","Valor",10,6,"Hand wraps from a mentor or a book about your secret hobby","STAGGERING STRIKE: Spend 3 Hope when you hit an adversary to also deal them a Stress and make them temporarily Staggered.","I AM THE WEAPON\nWhile you don't have any equipped weapons:\n• Your Evasion has a +1 bonus.\n• Your unarmed strikes deal d8+d6 phy damage.\n\nCOMBO STRIKES\nAfter making a damage roll with a Melee weapon, mark a Stress to start a combo strike with your Combo Die (starts d4)."],
      ["Warlock","Dread","Grace",11,5,"A carving that symbolizes your patron or a ring you can't remove","PATRON'S BOON: Spend 3 Hope to call out to your patron for help, gaining 1d4 Favor.","WARLOCK PATRON\nYou have committed yourself to a patron in exchange for power. Choose their spheres of influence (+2 bonus). Spend Favor to add its value to rolls related to spheres.\n\nFAVOR\nStart with 3 Favor. During a rest, tithe to your patron to gain Favor equal to your Presence."],
      ["Assassin","Midnight","Blade",12,5,"A list of names with several marked off or a mortar and pestle","GRIM RESOLVE: Spend 3 Hope to clear 2 Stress.","MARKED FOR DEATH\nOn a successful weapon attack, mark a Stress to make the target Marked for Death. Attacks gain +1d4 per tier damage bonus.\n\nGET IN & GET OUT\nSpend a Hope to ask the GM for a quick or inconspicuous way into or out of a building."],
      ["Witch","Dread","Sage",10,6,"A handcrafted besom or a pouch of animal bones","WITCH'S CHARM: When you or an ally within Far range rolls a failure, spend 3 Hope to change into a success with Fear instead.","HEX\nWhen a creature causes you or an ally to mark Hit Points, mark a Stress to Hex them. Action and damage rolls gain a bonus equal to your tier.\n\nCOMMUNE\nOnce per long rest, commune with an ancestor, deity, or spirit. Ask a question and roll d6s equal to your Spellcast trait."],
      ["Blood Hunter","Blade","Blood",9,7,"A steel needle or a vial holding a foe's blood","BLOOD MALEDICT: Spend 3 Hope to target a creature within Far range. Until you finish a rest, you have advantage on all action rolls against the target.","CRIMSON RITE\nMark a Hit Point to enchant a weapon. It deals extra 1d6 damage (2d6 at level 5, 3d6 at level 8).\n\nGRIM PSYCHOMETRY\nInspect a creature/location/object. Make a Spellcast Roll (12). On success, mark a Stress to have a vision of the most recent violence."],
    ];

    for (const [name,d1,d2,ev,hp,inv,hope,feat] of classes) {
      cards.push({
        card_type: "class", name, source: null, content: feat as string,
        metadata: { domain1: d1, domain2: d2, evasion: ev, starting_hp: hp, inventory: inv, hope_feature: hope, class_feature: feat }
      });
    }

    // === COMMUNITY CARDS ===
    const communities = [
      ["Highborne","Privilege","You have advantage on rolls to consort with nobles, negotiate prices, or leverage your reputation."],
      ["Loreborne","Well-Read","You have advantage on rolls that invoke the history, culture, or politics of a prominent person or place."],
      ["Orderborne","Dedicated","Record three sayings or values your upbringing instilled in you. Once per rest, when you describe how you're embodying one of these principles, you can roll a d20 as your Hope Die."],
      ["Ridgeborne","Steady","You have advantage on rolls to traverse dangerous cliffs and ledges, navigate harsh environments, and use your survival knowledge."],
      ["Seaborne","Know The Tide","You can sense the ebb and flow of life. When you roll with Fear, place a token. Spend tokens before action rolls for +1 bonus each."],
      ["Slyborne","Scoundrel","You have advantage on rolls to negotiate with criminals, detect lies, or find a safe place to hide."],
      ["Underborne","Low-Light Living","In low light or heavy shadow, you have advantage on rolls to hide, investigate, or perceive details."],
      ["Wanderborne","Nomadic Pack","Add a Nomadic Pack to your inventory. Once per session, spend a Hope to pull out a useful mundane item."],
      ["Wildborne","Lightfoot","Your movement is naturally silent. You have advantage on rolls to move without being heard."],
      ["Duneborne","Oasis","During a short rest, you or an ally can reroll a die used for a downtime action."],
      ["Freeborne","Unbound","Once per session, when you make an action roll with Fear, you can instead change it to a roll with Hope."],
      ["Frostborne","Long Winter","Once per rest, you can Help an Ally traverse difficult terrain without spending Hope."],
      ["Hearthborne","Close-Knit","Once per long rest, you can spend any number of Hope to give an ally the same number of Hope."],
      ["Reborne","Found Family","Once per session, spend a Hope to use an ally's community ability. Your ally gains a Hope."],
      ["Warborne","Brave Face","Once per session, when an attack would cause you to mark a Stress, you can spend a Hope instead."],
    ];

    for (const [src, title, content] of communities) {
      cards.push({ card_type: "community", name: title as string, source: src, content });
    }

    // === ANCESTRY CARDS ===
    const ancestries = [
      ["Clank","Purposeful Design","Decide who made you and for what purpose. Choose one Experience that aligns with this purpose and gain a permanent +1 bonus to it."],
      ["Clank","Efficient","When you take a short rest, you can choose a long rest move instead of a short rest move."],
      ["Drakona","Scales","Your scales act as natural protection. When you would take Severe damage, mark a Stress to mark 1 fewer Hit Points."],
      ["Drakona","Elemental Breath","Choose an element for your breath. Use against targets within Very Close range, treating it as an Instinct weapon that deals d8 magic damage."],
      ["Dwarf","Thick Skin","When you take Minor damage, you can mark 2 Stress instead of marking a Hit Point."],
      ["Dwarf","Increased Fortitude","Spend 3 Hope to halve incoming physical damage."],
      ["Elf","Quick Reactions","Mark a Stress to gain advantage on a reaction roll."],
      ["Elf","Celestial Trance","During a rest, you can drop into a trance to choose an additional downtime move."],
      ["Faerie","Luckbender","Once per session, after you or a willing ally within Close range makes an action, spend 3 Hope to reroll the Duality Dice."],
      ["Faerie","Wings","You can fly. While flying, mark a Stress after an adversary attacks to gain +2 Evasion against that attack."],
      ["Faun","Caprine Leap","You can leap anywhere within Close range as though you were using normal movement."],
      ["Faun","Kick","On a successful attack in Melee range, mark a Stress to kick, dealing extra 2d6 damage and knocking to Very Close range."],
      ["Firbolg","Charge","When you succeed on an Agility Roll to move into Melee range, mark a Stress to deal 1d12 physical damage to all targets."],
      ["Firbolg","Unshakable","When you would mark a Stress, roll a d6. On a 6, don't mark it."],
      ["Fungril","Fungril Network","Make an Instinct Roll (12) to speak with others of your ancestry across any distance."],
      ["Fungril","Death Connection","While touching a recent corpse, mark a Stress to extract one memory related to an emotion of your choice."],
      ["Galapa","Shell","Gain a bonus to your damage thresholds equal to your Proficiency."],
      ["Galapa","Retract","Mark a Stress to retract into your shell. Resistance to physical damage, disadvantage on action rolls, can't move."],
      ["Giant","Endurance","Gain an additional Hit Point slot at character creation."],
      ["Giant","Reach","Treat Melee range as Very Close range for weapons, abilities, and spells."],
      ["Goblin","Surefooted","You ignore disadvantage on Agility Rolls."],
      ["Goblin","Danger Sense","Once per rest, mark a Stress to force an adversary to reroll an attack against you or an ally within Very Close range."],
      ["Halfling","Luckbringer","At the start of each session, everyone in your party gains a Hope."],
      ["Halfling","Internal Compass","When you roll a 1 on your Hope Die, you can reroll it."],
      ["Human","High Stamina","Gain an additional Stress slot at character creation."],
      ["Human","Adaptability","When you fail a roll that utilized one of your Experiences, mark a Stress to reroll it."],
      ["Infernis","Fearless","When you roll with Fear, mark 2 Stress to change it into a roll with Hope instead."],
      ["Infernis","Dread Visage","You have advantage on rolls to intimidate hostile creatures."],
      ["Katari","Feline Instincts","When you make an Agility Roll, spend 2 Hope to reroll your Hope Die."],
      ["Katari","Retracting Claws","Make an Agility Roll to scratch a target in Melee range. On success, they become temporarily Vulnerable."],
      ["Orc","Sturdy","When you have 1 Hit Point remaining, attacks against you have disadvantage."],
      ["Orc","Tusks","On a successful Melee attack, spend a Hope to gore with tusks for extra 1d6 damage."],
      ["Ribbet","Amphibious","You can breathe and move naturally underwater."],
      ["Ribbet","Long Tongue","Use your long tongue to grab things within Close range. Mark a Stress for d12 physical damage weapon."],
      ["Simiah","Natural Climber","You have advantage on Agility Rolls that involve balancing and climbing."],
      ["Simiah","Nimble","Gain a permanent +1 bonus to your Evasion at character creation."],
      ["Earthkin","Hard As Stone","After marking Hit Points, spend 2 Hope for +1 damage threshold bonus until next rest."],
      ["Earthkin","Tectonic Attack","Strike the ground to make a weapon attack against all targets within Very Close range. d8 magic damage and temporarily Restrained."],
      ["Tidekin","Amphibious","You can breathe and move naturally underwater."],
      ["Tidekin","Lifespring","Once per rest, with water access, mark 2 Stress to heal a Hit Point on yourself or an ally."],
      ["Emberkin","Incinerator","Mark a Stress to light yourself Ablaze. Adversaries ending attacks in Melee must mark a Stress."],
      ["Emberkin","Fireshot","Unleash a fire projectile within Far range. d10+5 magic damage on failed reaction roll."],
      ["Skykin","Gust Leap","Once per rest, call upon wind to carry you to a point within Very Far range."],
      ["Skykin","Gale Force","Instinct Roll against targets in front within Very Close range. d6 magic damage and forced back to Far range."],
      ["Aetheris","Hallowed Aura","Once per rest, when an ally within Close range rolls with Fear, make it a roll with Hope instead."],
      ["Aetheris","Divine Countenance","You have advantage on rolls to command or persuade."],
      ["Gnome","Nimble Fingers","When you make a Finesse Roll, spend 2 Hope to reroll your Hope die."],
      ["Gnome","True Sight","You have advantage on rolls to see through illusions."],
    ];

    for (const [src, title, content] of ancestries) {
      cards.push({ card_type: "ancestry", name: title as string, source: src, content });
    }

    // === SUBCLASS CARDS ===
    const subclasses = [
      ["Bard","Troubadour","Presence","GIFTED PERFORMER: Play each song once per long rest:\n• RELAXING SONG: Clear a Hit Point on you and allies.\n• EPIC SONG: Make a target Vulnerable.\n• HEARTBREAKING SONG: Gain a Hope.","MAESTRO: When you give a Rally Die to an ally, they can gain a Hope or clear a Stress.","VIRTUOSO: You can perform each song twice instead of once per long rest."],
      ["Bard","Wordsmith","Presence","ROUSING SPEECH: Once per long rest, all allies within Far range clear 2 Stress.\nHEART OF A POET: After a Presence roll, spend a Hope to add a d4.","ELOQUENT: Once per session, encourage an ally for a special benefit.","EPIC POETRY: Rally Die increases to d10. When you Help an Ally, roll a d10 as your advantage die."],
      ["Druid","Way of the Elements","Instinct","ELEMENTAL INCARNATION: Mark a Stress to Channel an element (Fire, Earth, Water, Air) with unique benefits.","ELEMENTAL AURA: Once per rest while Channeling, assume a matching aura affecting targets within Close range.","ELEMENTAL DOMINION: Further embody your element with enhanced benefits while Channeling."],
      ["Druid","Way of Renewal","Instinct","CLARITY OF NATURE: Once per long rest, create a serene space to clear Stress equal to your Instinct.\nREGENERATION: Touch a creature and spend 3 Hope to clear 1d4 Hit Points.","REGENERATIVE REACH: Target creatures within Very Close range with Regeneration.\nWARDEN'S PROTECTION: Once per long rest, spend 2 Hope to clear 2 Hit Points on 1d4 allies.","DEFENDER: In Beastform, when an ally marks 2+ Hit Points, mark a Stress to reduce by 1."],
      ["Guardian","Stalwart","-","UNWAVERING: Gain permanent +1 to damage thresholds.\nIRON WILL: When you take physical damage, mark an additional Armor Slot to reduce severity.","UNRELENTING: Gain permanent +2 to damage thresholds.\nPARTNERS-IN-ARMS: When an ally within Very Close range takes damage, mark an Armor Slot to reduce severity.","UNDAUNTED: Gain permanent +3 to damage thresholds.\nLOYAL PROTECTOR: When an ally with 2 or fewer HP would take damage, mark a Stress to take it instead."],
      ["Guardian","Vengeance","-","AT EASE: Gain an additional Stress slot.\nREVENGE: When an adversary succeeds on an attack, mark 2 Stress to force them to mark a Hit Point.","ACT OF REPRISAL: When an adversary damages an ally in Melee, gain +1 Proficiency against them.","NEMESIS: Spend 2 Hope to Prioritize an adversary. Swap Hope and Fear Dice results on attacks against them."],
      ["Ranger","Beastbound","Agility","COMPANION: You have an animal companion that stays by your side.","EXPERT TRAINING: Choose an additional level-up option.\nBATTLE-BONDED: +2 Evasion when adversary attacks you near companion.","ADVANCED TRAINING: Choose two additional level-up options.\nLOYAL FRIEND: Once per long rest, you or companion can take damage for the other."],
      ["Ranger","Wayfinder","Agility","RUTHLESS PREDATOR: Mark a Stress for +1 Proficiency on damage. Severe damage forces Stress.\nPATH FORWARD: Identify shortest path to visited locations.","ELUSIVE PREDATOR: +2 Evasion when your Focus attacks you.","APEX PREDATOR: Spend a Hope before attacking Focus. On success, remove a Fear from GM's pool."],
      ["Rogue","Night Walker","Finesse","SHADOW STEPPER: Mark a Stress to teleport between shadows within Far range. Become Cloaked.","DARK CLOUD: Create a dark cloud within Close range.\nADRENALINE: While Vulnerable, add level to damage rolls.","FLEETING SHADOW: +1 Evasion. Shadow Step within Very Far range.\nVANISHING ACT: Mark a Stress to become Cloaked at any time."],
      ["Rogue","Syndicate","Finesse","WELL-CONNECTED: When you arrive in a town, you know somebody there. Choose a complication.","CONTACTS EVERYWHERE: Once per session, call on a shady contact for various benefits.","RELIABLE BACKUP: Use Contacts three times per session with additional benefit options."],
      ["Seraph","Divine Wielder","Strength","SPIRIT WEAPON: Equipped Melee weapon can fly to attack within Close range.\nSPARING TOUCH: Once per long rest, clear 2 HP or 2 Stress on a creature you touch.","DEVOUT: Roll additional Prayer Die and discard lowest. Use Sparing Touch twice per long rest.","SACRED RESONANCE: If damage dice match, double the matching dice values."],
      ["Seraph","Winged Sentinel","Strength","WINGS OF LIGHT: You can fly. Mark a Stress to carry a creature. Spend a Hope for +1d8 damage.","ETHEREAL VISAGE: While flying, advantage on Presence Rolls. Success with Hope removes a Fear.","ASCENDANT: +4 to Severe threshold. +1d12 damage instead of 1d8 while flying."],
      ["Sorcerer","Elemental Origin","Instinct","ELEMENTALIST: Choose an element. Spend a Hope for +2 to action roll or +3 to damage.","NATURAL EVASION: Mark a Stress to roll d6 and add to Evasion against an attack.","TRANSCENDENCE: Once per long rest, transform into your element. Choose two benefits."],
      ["Sorcerer","Primal Origin","Instinct","MANIPULATE MAGIC: After casting, mark a Stress to extend range, +2 to roll, double a damage die, or hit additional target.","ENCHANTED AID: When Helping with Spellcast, roll d8 as advantage die. Once per long rest, swap ally's Duality Dice.","ARCANE CHARGE: When you take magic damage, become Charged. Spend 2 Hope alternatively. +10 damage or +3 Difficulty on next magic attack."],
      ["Warrior","Call of the Brave","-","COURAGE: When you fail with Fear, gain a Hope.\nBATTLE RITUAL: Once per long rest, before great danger, clear 2 Stress and gain 2 Hope.","RISE TO THE CHALLENGE: With 2 or fewer HP, roll d20 as Hope Dice.","CAMARADERIE: Extra Tag Team Roll per session. Allies only need 2 Hope for Tag Team with you."],
      ["Warrior","Call of the Slayer","-","SLAYER: Gain a pool of Slayer Dice. On Hope rolls, place d6 instead of gaining Hope. Spend on attack/damage rolls.","WEAPON SPECIALIST: Spend a Hope to add secondary weapon damage die. Reroll 1s on Slayer Dice once per long rest.","MARTIAL PREPARATION: Party gains martial Preparation downtime. All gain d6 Slayer Die."],
      ["Wizard","School of Knowledge","Knowledge","PREPARED: Take an additional domain card.\nADEPT: Mark a Stress instead of spending Hope to double Experience modifier.","ACCOMPLISHED: Take an additional domain card.\nPERFECT RECALL: Once per rest, reduce Recall Cost by 1.","BRILLIANT: Take an additional domain card.\nHONED EXPERTISE: Roll d6 when using Experience; on 5+, no Hope cost."],
      ["Wizard","School of War","Knowledge","BATTLEMAGE: Gain an additional Hit Point slot.\nFACE YOUR FEAR: When you succeed with Fear, deal extra 1d10 magic damage.","CONJURE SHIELD: With 2+ Hope, add Proficiency to Evasion.\nFUELED BY FEAR: Extra damage increases to 2d10.","THRIVE IN CHAOS: On successful attack, mark a Stress to force extra Hit Point.\nHAVE NO FEAR: Extra damage increases to 3d10."],
      ["Brawler","Juggernaut","-","POWERHOUSE: Unarmed d10s. Mark Stress to target two in Melee.\nOVERWHELM: Spend Hope to force Stress or throw target.","RUGGED: +3 Severe threshold. Target three creatures.\nEYE FOR AN EYE: When marked 2+ HP in melee, attacker makes Reaction Roll.","PUMMELJOY: On crit, extra Hope, clear Stress, +1 Proficiency.\nNOT DONE YET: When marked 2+ HP, gain Hope or clear Stress."],
      ["Brawler","Martial Artist","-","MARTIAL FORM: Start with two Tier 1 stances.\nFOCUS: Roll d6s equal to Instinct, gain Focus tokens equal to highest value.","KEEN DEFENSES: Spend Focus for attack disadvantage.\nSPIRIT BLAST: Spend Focus for d20+3 magic damage.","LIMIT BREAKER: Once per rest, perform an impossible feat without rolling."],
      ["Warlock","Pact of the Endless","Presence","PATRON'S MANTLE: Mark Stress for terrifying aspect. Spend Favor instead of Armor.\nDEADLY DEVOTION: Spend Favor for +1 Evasion.","DRAINING INVOCATION: Spend Favor to make adversary use d12. They mark Stress, you clear Stress.","DARK AEGIS: Once per long rest, spend Favor instead of marking HP.\nDRAINING BANE: Spend 2 Favor to permanently Drain them."],
      ["Warlock","Pact of the Wrathful","Presence","FAVORED WEAPON: Mark Stress to Imbue weapon. Spend Favor for +1d6 damage each.\nHERALD OF DEATH: Spend Favor to reroll failed attack.","MENACING REACH: Mark additional Stress to increase Imbued weapon range.\nDIMINISH MY FOES: On Hope success, spend Hope to force Stress.","FEARSOME ATTACK: Spend Favor to reroll any damage dice.\nDIVINE IRE: Once per rest, spend Favor to force that many adversaries to mark HP."],
      ["Assassin","Executioners Guild","Agility","FIRST STRIKE: First successful attack in a scene deals double damage.\nBACKSTAB: Marked for Death uses d6s instead of d4s.","DEATH STRIKE: On Severe damage, mark Stress for extra HP.\nSCORPION'S POISE: +2 Evasion against Marked for Death targets.","TRUE STRIKE: Once per long rest, spend Hope to turn failed attack into success.\nBACKSTAB: Uses d8s instead of d6s."],
      ["Assassin","Poisoners Guild","Knowledge","TOXIC CONCOCTIONS: Mark Stress for 1d4+1 poison tokens. Three known poisons.\nENVENOMATE: On successful attack, spend token to apply poison.","POISON COMPENDIUM: Two additional poisons.\nADDER'S BLESSING: Immune to poisons and toxins.","VENOMANCER: Two additional poisons.\nTWIN FANG: Spend extra token to apply two poisons."],
      ["Witch","Hedge","Instinct","HERBAL REMEDIES: Using consumables clears an extra HP or Stress.\nTETHERED TALISMAN: Once per rest, imbue item with protection to reduce HP marked by 1.","WALK BETWEEN WORLDS: Spellcast Roll (13) to converse with spirits.\nENHANCED HEX: Attacks against Hexed gain damage bonus equal to Proficiency.","CIRCLE OF POWER: Once per rest, create a circle. While inside: +4 thresholds, +2 attack, +1 Evasion."],
      ["Witch","Moon","Instinct","NIGHT'S GLAMOUR: Mark Stress to Glamour yourself. Disguise or enhance appearance.","MOON BEAM: Once per session, conjure moonlight for +1 Spellcast and advantage vs illusions.\nIRE OF PALE LIGHT: Hexed creatures mark Stress on failed attacks.","LUNAR PHASES: Roll d4 at session start for a moon phase effect (New, Waxing, Full, Waning)."],
      ["Blood Hunter","Order of the Ghost Slayer","Agility","CHASING DEATH: With 1-3 unmarked HP, Crimson Rite is free. With 1 HP, use d8s.\nSHADOWED GRIT: When GM gains Fear, mark Stress to gain Hope.","VEILWALKER: Spend 2 Hope to teleport to a creature/corpse within Far range. Advantage on next attack.","SPECTRAL FORM: Death move option - clear HP, become spectral, resistance to physical, pass through objects."],
      ["Blood Hunter","Order of the Mutant","Agility","MUTAGENS: After rest, drink a toxin for +1 trait, -1 different trait, and a benefit (Celerity, Durable, or Hunter's Senses).","IMPROVED MUTAGENS: Additional options (Nerves of Steel, Rapidity, Ironskin).\nVOLATILE TOXINS: Choose two benefits but mark a permanent HP.","MASTERED MUTAGENS: +2/-2 trait bonus/penalty. Additional options (Aetherblood, Fury, Steelflesh)."],
      ["Blood Hunter","Order of the Lycan","Strength","WEREWOLF: Gain Werewolf Transformation card. Advantage on hearing/scent perception.\nCONTROL THE BEAST: In Wolf Form, apply bonus die to Agility and Strength.","FERAL HIDE: In Wolf Form, +Tier to Damage Thresholds.\nLYCAN REGENERATION: In Wolf Form with all HP marked, mark Stress to clear HP.","MASTER THE BEAST: When last Stress would be marked in Wolf Form, put a Domain card in Vault instead.\nOn Frenzy, gain 2 Hope."],
    ];

    for (const [cls, name, trait, found, spec, mast] of subclasses) {
      cards.push({
        card_type: "subclass", name: name as string, source: cls, content: found as string,
        metadata: { spellcast_trait: trait, foundation: found, specialization: spec, mastery: mast }
      });
    }

    // === DOMAIN CARDS ===
    const domains = [
      ["Blade","A Soldier's Bond",2,"Ability",1,"Once per long rest, when you compliment someone or ask them about something they're good at, you can both gain 3 Hope."],
      ["Arcana","Adjust Reality",10,"Spell",1,"After you or a willing ally make any roll, you can spend 5 Hope to change the numerical result of that roll to a result of your choice instead. The result must be plausible within the range of the dice."],
      ["Arcana","Arcana-Touched",7,"Spell",2,"When 4 or more of the domain cards in your loadout are from the Arcana domain, gain the following benefits:\n* +1 bonus to your Spellcast Rolls\n* Once per rest, you can switch the results of your Hope and Fear Dice."],
      ["Arcana","Arcane Reflection",8,"Spell",1,"When you would take magic damage, you can spend any number of Hope to roll that many d6s. If any roll a 6, the attack is reflected back to the caster, dealing the damage to them instead."],
      ["Valor","Armorer",5,"Ability",1,"While you're wearing armor, gain a +1 bonus to your Armor Score.\nDuring a rest, when you choose to repair your armor as a downtime move, your allies also clear an Armor Slot."],
      ["Grace","Astral Projection",8,"Spell",0,"Once per long rest, mark a Stress to create a projected copy of yourself that can appear anywhere you've been before.\nYou can see and hear through the projection as though it were you and affect the world as though you were there. A creature investigating the projection can tell it's of magical origin. This effect lasts until your next rest or your projection takes any damage."],
      ["Dread","Avatar Of Malice",10,"Spell",1,"You can mark a Stress to transform into an avatar of malice, gaining the following benefits:\n* All adversaries within Close range must spend an additional Fear when using a Fear feature.\n* When you defeat a creature within Close range, you absorb their life essence and clear a Hit Point.\n* You can mark a Stress to teleport to a location within Very Far range.\nEvery time you make an action roll in this form, you must spend a Hope. If you can't, you drop this form."],
      ["Codex","Banish",6,"Spell",0,"Make a Spellcast Roll against a target within Close range. On a success, roll a number of d20s equal to your Spellcast trait. The target must make a reaction roll with a Difficulty equal to your highest result. On a success, the target must mark a Stress but isn't banished. Once per rest on a failure, they are banished from this realm.\nWhen the PCs roll with Fear, the Difficulty gains a −1 penalty and the target makes another reaction roll. On a success, they return from banishment."],
      ["Valor","Bare Bones",1,"Ability",0,"When you choose not to equip armor, you have a base Armor Score of 3 + your Strength and use the following as your base damage thresholds:\n• Tier1:9/19\n• Tier2:11/24\n• Tier3:13/31\n• Tier4:15/38"],
      ["Blade","Battle Cry",8,"Ability",2,"Once per long rest, while you're charging into danger, you can muster a rousing call that inspires your allies. All allies who can hear you each clear a Stress and gain a Hope. Additionally, your allies gain advantage on attack rolls until you or an ally rolls a failure with Fear."],
      ["Blade","Battle Monster",10,"Ability",0,"When you make a successful attack against an adversary, you can mark 4 Stress to force the target to mark a number of Hit Points equal to the number of Hit Points you currently have marked instead of rolling for damage."],
      ["Blade","Battle-Hardened",6,"Ability",2,"Once per long rest when you would make a Death Move, you can spend a Hope to clear a Hit Point instead."],
      ["Blade","Blade-Touched",7,"Ability",1,"When 4 or more of the domain cards in your loadout are from the Blade domain, gain the following benefits:\n• +2 bonus to your attack rolls\n• +4 bonus to your Severe damage threshold"],
      ["Dread","Blighting Strike",1,"Spell",1,"Make a Spellcast Roll against a target within Far range. On a success, the target takes d6 magic damage using your Proficiency and the next time the target deals damage to an ally, it is reduced by 1d6. If you succeed with Fear, the target instead takes d10 magic damage using your Proficiency."],
      ["Arcana","Blink Out",4,"Spell",1,"Make a Spellcast Roll (12). On a success, spend a Hope to teleport to another point you can see within Far range. If any willing creatures are within Very Close range, spend an additional Hope for each creature to bring them with you."],
      ["Blood","Blood Bind",6,"Spell",2,"Make a Spellcast Roll against a target within Far range. On a success, mark a Stress as you slow the target's vitality. The target is temporarily Restrained and temporarily Vulnerable. Each time the target is spotlighted while either of these conditions persists on them, the target takes d10 magic damage using your Proficiency. The spell ends early on the target if you use it again."],
      ["Blood","Blood Puppet",3,"Spell",2,"Make a Spellcast Roll against a creature (living or dead) within Far range. On a success, spend a Hope to control the target by causing them to move, attack, or both. If you do both, you choose the order. If you cause the creature to move, they move to a location you choose that's within Close range of them. If you cause the creature to attack, make a Spellcast Roll against a target within Melee range of them. On a success, deal d10 physical damage using your Proficiency."],
      ["Blood","Blood Spike",1,"Spell",1,"Make a Spellcast Roll against a target within Far range. On a success, mark a Stress to deal d10 magic damage to the target using your Proficiency. On a success with Hope, the target also marks a Stress. On a roll with Fear, mark a Stress."],
      ["Blood","Bloodbath",9,"Spell",2,"Once per rest, spend a Hope to unleash waves of blood around yourself. Make a single Spellcast Roll against each adversary within Close range. On a success, a target marks a Hit Point and a Stress. On a failure, a target marks a Stress.\nEach ally within Close range marks a Stress but clears a Hit Point."],
      ["Blood","Blood-Touched",7,"Ability",1,"While 4 or more of the domain cards in your loadout are from the Blood domain, gain the following benefits:\n• When you take enough damage to mark 2 or more Hit Points, gain a Hope.\n• For every 3 Hit Points you have marked, gain a +1 bonus to your Evasion."],
      ["Valor","Body Basher",2,"Ability",1,"You use the full force of your body in a fight. On a successful attack using a weapon with a Melee range, gain a bonus to your damage roll equal to your Strength."],
      ["Valor","Bold Presence",2,"Ability",0,"When you make a Presence Roll, you can spend a Hope to add your Strength to the roll.\nAdditionally, once per rest when you would gain a condition, you can describe how your bold presence aids you in the situation and avoid gaining the condition."],
      ["Splendor","Bolt Beacon",1,"Spell",1,"Make a Spellcast Roll against a target within Far range.\nOn a success, spend a Hope to send a bolt of shimmering light toward them, dealing d8+2 magic damage using your Proficiency. The target becomes temporarily Vulnerable and glows brightly until this condition is cleared."],
      ["Bone","Bone-Touched",7,"Ability",2,"When 4 or more of the domain cards in your loadout are from the Bone domain, gain the following benefits:\n• +1 bonus to Agility\n• Once per rest, you can spend 3 Hope to cause an attack that succeeded against you to fail instead."],
      ["Codex","Book Of Ava",1,"Grimoire",2,"Power Push: Make a Spellcast Roll against a target within Melee range.\nOn a success, they're knocked back to Far range and take d10+2 magic damage using your Proficiency.\nTava's Armor: Spend a Hope to give a target you can touch a +1 bonus to their Armor Score until their next rest or you cast Tava's Armor again.\nIce Spike: Make a Spellcast Roll (12) to summon a large ice spike within Far range. If you use it as a weapon, make the Spellcast Roll against the target's Difficulty instead. On a success, deal d6 physical damage using your Proficiency."],
      ["Codex","Book Of Exota",4,"Grimoire",3,"Repudiate: You can interrupt a magical effect taking place. Make a reaction roll using your Spellcast trait. Once per rest on a success, the effect stops and any consequences are avoided. Create Construct: Spend a Hope to choose a group of objects around you and create an animated construct from them that obeys basic commands. Make a Spellcast Roll to command them to take action. When necessary, they share your Evasion and traits and their attacks deal 2d10+3 physical damage. You can only maintain one construct at a time, and they fall apart when they take any amount of damage."],
      ["Codex","Book Of Grynn",4,"Grimoire",2,"Arcane Deflection: Once per long rest, spend a Hope to negate the damage of an attack targeting you or an ally within Very Close range.\nTime Lock: Target an object within Far range. That object stops in time and space exactly where it is until your next rest. If a creature tries to move it, make a Spellcast Roll against them to maintain this spell.\nWall of Flame: Make a Spellcast Roll (15). On a success, create a wall of magical flame between two points within Far range. All creatures in its path must choose a side to be on, and anything that subsequently passes through the wall takes 4d10+3 magic damage."],
      ["Codex","Book Of Homet",7,"Grimoire",0,"Pass Through: Make a Spellcast Roll (13). Once per rest on a success, you and all creatures touching you can pass through a wall or door within Close range. The effect ends once everyone is on the other side.\nPlane Gate: Make a Spellcast Roll (14). Once per long rest on a success, open a gateway to a location in another dimension or plane of existence you've been to before. This gateway lasts until your next rest."],
      ["Codex","Book Of Illiat",1,"Grimoire",2,"Slumber: Make a Spellcast Roll against a target within Very Close range. On a success, they're Asleep until they take damage or the GM spends a Fear on their turn to clear this condition.\nArcane Barrage: Once per rest, spend any number of Hope and shoot magical projectiles that strike a target of your choice within Close range. Roll a number of d6s equal to the Hope spent and deal that much magic damage to the target.\nTelepathy: Spend a Hope to open a line of mental communication with one target you can see. This connection lasts until your next rest or you cast Telepathy again."],
      ["Codex","Book Of Korvax",3,"Grimoire",2,"Levitation: Make a Spellcast Roll to temporarily lift a target you can see up into the air and move them within Close range of their original position.\nRecant: Spend a Hope to force a target within Melee range to make a Reaction Roll (15). On a failure, they forget the last minute of your conversation.\nRune Circle: Mark a Stress to create a temporary magical circle on the ground where you stand. All adversaries within Melee range, or who enter Melee range, take 2d12+4 magic damage and are knocked back to Very Close range."],
      ["Codex","Book Of Norai",3,"Grimoire",2,"Mystic Tether: Make a Spellcast Roll against a target within Far range. On a success, they're temporarily Restrained and must mark a Stress. If you target a flying creature, this spell grounds and temporarily Restrains them.\nFireball: Make a Spellcast Roll against a target within Very Far range. On a success, hurl a sphere of fire toward them that explodes on impact. The target and all creatures within Very Close range of them must make a Reaction Roll (13). Targets who fail take d20+5 magic damage using your Proficiency. Targets who succeed take half damage."],
      ["Codex","Book Of Ronin",9,"Grimoire",4,"Transform: Make a Spellcast Roll (15). On a success, transform into an inanimate object no larger than twice your normal size. You can remain in this shape until you take damage.\nEternal Enervation: Once per long rest, make a Spellcast Roll against a target within Close range. On a success, they become permanently Vulnerable. They can't clear this condition by any means."],
      ["Codex","Book Of Sitil",2,"Grimoire",2,"Adjust Appearance: You magically shift your appearance and clothing to avoid recognition.\nParallela: Spend 2 Hope to cast this spell on yourself or an ally within Close range. The next time the target makes an attack, they can hit an additional target within range that their attack roll would succeed against. You can only hold this spell on one creature at a time.\nIllusion: Make a Spellcast Roll (14). On a success, create a temporary visual illusion no larger than you within Close range that lasts for as long as you look at it. It holds up to scrutiny until an observer is within Melee range."],
      ["Codex","Book Of Tyfar",1,"Grimoire",2,"Wild Flame: Make a Spellcast Roll against up to three adversaries within Melee range. Targets you succeed against take 2d6 magic damage and must mark a Stress as flames erupt from your hand.\nMagic Hand: You conjure a magical hand with the same size and strength as your own within Far range.\nMysterious Mist: Make a Spellcast Roll (13) to cast a temporary thick fog that gathers in a stationary area within Very Close range. The fog heavily obscures this area and everything in it."],
      ["Codex","Book Of Vagras",2,"Grimoire",2,"Runic Lock: Make a Spellcast Roll (15) on an object you're touching that can close (such as a lock, chest, or box). Once per rest on a success, you can lock the object so it can only be opened by creatures of your choice. Someone with access to magic and an hour of time to study the spell can break it.\nArcane Door: When you have no adversaries within Melee range, make a Spellcast Roll (13). On a success, spend a Hope to create a portal from where you are to a point within Far range you can see. It closes once a creature has passed through it.\nReveal: Make a Spellcast Roll. If there is anything magically hidden within Close range, it is revealed."],
      ["Codex","Book Of Vyola",8,"Grimoire",2,"Memory Delve: Make a Spellcast Roll against a target within Far range. On a success, peer into the target's mind and ask the GM a question. The GM describes any memories the target has pertaining to the answer.\nShared Clarity: Once per long rest, spend a Hope to choose two willing creatures. When one of them would mark Stress, they can choose between the two of them who marks it. This spell lasts until their next rest."],
      ["Codex","Book Of Yarrow",10,"Grimoire",2,"Timejammer: Make a Spellcast Roll (18). On a success, time temporarily slows to a halt for everyone within Far range except for you. It resumes the next time you make an action roll that targets another creature.\nMagic Immunity: Spend 5 Hope to become immune to magic damage until your next rest."],
      ["Bone","Boost",4,"Ability",1,"Mark a Stress to boost off a willing ally within Close range, fling yourself into the air, and perform an aerial attack against a target within Far range. You have advantage on the attack, add a d10 to the damage roll, and end your move within Melee range of the target."],
      ["Bone","Brace",3,"Ability",1,"When you mark an Armor Slot to reduce incoming damage, you can mark a Stress to mark an additional Armor Slot."],
      ["Blood","Brand Of Castigation",2,"Spell",1,"When you deal damage to a creature, mark a Stress to sear a red, magical mark on them. Until this mark disappears, you always know the direction of the marked creature relative to you, and that creature marks a Stress each time it deals damage to you or an ally of yours within Very Close range of you. The mark disappears when you use this spell again."],
      ["Bone","Breaking Blow",8,"Ability",3,"When you make a successful attack, you can mark a Stress to make the next successful attack against that same target deal an extra 2d12 damage."],
      ["Blood","Burning Blood",3,"Spell",2,"Make a Spellcast Roll (12). On a success, mark a Hit Point as you conjure a bead of blood, which you lob at a point within Far range. A wave of heat fills the area within Very Close range of that point, igniting the internal vitals of those caught within. Each target within the area marks 1 Hit Point. On a success with Hope, each target within the area instead marks 2 Hit Points."],
      ["Arcana","Chain Lightning",5,"Spell",1,"Mark 2 Stress to make a Spellcast Roll, unleashing lightning on all targets within Close range. Targets you succeed against must make a reaction roll with a Difficulty equal to the result of your Spellcast Roll. Targets who fail take 2d8+4 magic damage. Additional adversaries not already targeted by Chain Lightning and within Close range of previous targets who took damage must also make the reaction roll. Targets who fail take 2d8+4 magic damage. This chain continues until there are no more adversaries within range."],
      ["Blade","Champion's Edge",5,"Ability",1,"When you critically succeed on an attack, you can spend up to 3 Hope and choose one of the following options for each Hope spent:\n• You clear a Hit Point.\n• You clear an Armor Slot.\n• The target must mark an additional Hit Point.\nYou can't choose the same option more than once."],
      ["Midnight","Chokehold",3,"Ability",1,"When you position yourself behind a creature who's about your size, you can mark a Stress to pull them into a chokehold, making them temporarily Vulnerable.\nWhen a creature attacks a target who is Vulnerable in this way, they deal an extra 2d6 damage."],
      ["Arcana","Cinder Grasp",2,"Spell",1,"Make a Spellcast Roll against a target within Melee range. On a success, the target instantly bursts into flames, takes 1d20+3 magic damage and is temporarily lit On Fire.\nWhen a creature acts while On Fire, they must take an extra 2d6 magic damage if they are still On Fire at the end of their action."],
      ["Arcana","Cloaking Blast",7,"Spell",2,"When you make a successful Spellcast Roll to cast a different spell, you can spend a Hope to become Cloaked. While Cloaked, you remain unseen if you are stationary when an adversary moves to where they would normally see you. When you move into or within an adversary's line of sight or make an attack, you are no longer Cloaked."],
      ["Codex","Codex-Touched",7,"Ability",2,"When 4 or more of the domain cards in your loadout are from the Codex domain, gain the following benefits:\n• You can mark a Stress to add your Proficiency to a Spellcast Roll.\n• Once per rest, replace this card with any card from your vault without paying its Recall Cost."],
      ["Arcana","Confusing Aura",8,"Spell",2,"Make a Spellcast Roll (14). Once per long rest on a success, you create a layer of illusion over your body that makes it hard to tell exactly where you are. Mark any number of Stress to make that many additional layers. When an adversary makes an attack against you, roll a number of d6s equal to the number of layers currently active. If any roll a 5 or higher, one layer of the aura is destroyed and the attack fails. If all the results are 4 or lower, you take the damage and this spell ends."],
      ["Sage","Conjure Swarm",2,"Spell",1,"Tekaira Armored Beetles: Mark a Stress to conjure armored beetles that encircle you. When you next take damage, reduce the severity by one threshold. You can spend a Hope to keep the beetles conjured after taking damage.\nFire Flies: Make a Spellcast Roll against all adversaries within Close range. Spend a Hope to deal 2d8+3 magic damage to targets you succeeded against."],
      ["Sage","Conjured Steeds",6,"Spell",0,"Spend any number of Hope to conjure that many magical steeds (such as horses, camels, or elephants) that you and your allies can ride until your next long rest or the steeds take any damage. The steeds double your land speed while traveling and, when in danger, allow you to move within Far range without having to roll. Creatures riding a steed gain a −2 penalty to attack rolls and a +2 bonus to damage rolls."],
      ["Grace","Copycat",9,"Spell",3,"Once per long rest, this card can mimic the features of another domain card of level 8 or lower in another player's loadout. Spend Hope equal to half the card's level to gain access to the feature. It lasts until your next rest or they place the card in their vault."],
      ["Sage","Corrosive Projectile",3,"Spell",1,"Make a Spellcast Roll against a target within Far range. On a success, deal d6+4 magic damage using your Proficiency. Additionally, mark 2 or more Stress to make them permanently Corroded. While a target is Corroded, they gain a −1 penalty to their Difficulty for every 2 Stress you spent. This condition can stack."],
      ["Arcana","Counterspell",3,"Spell",2,"You can interrupt a magical effect taking place by making a reaction roll using your Spellcast trait. On a success, the effect stops and any consequences are avoided, and this card is placed in your vault."],
      ["Blood","Crimson Adamance",10,"Ability",1,"When you would mark your last Hit Point, spend a Hope to mark a Stress instead."],
      ["Valor","Critical Inspiration",3,"Ability",1,"Once per rest, when you critically succeed on an attack, all allies within Very Close range can clear a Stress or gain a Hope."],
      ["Bone","Cruel Precision",7,"Ability",1,"When you make a successful attack with a weapon, gain a bonus to your damage roll equal to either your Finesse or Agility."],
      ["Dread","Damnation",9,"Spell",2,"Make a Spellcast Roll against a target within Far range. On a success, mark 3 Stress and roll a number of d20s equal to your Spellcast trait, dealing that much damage to them. If this damage is enough to defeat or destroy the creature, all adversaries within Far range of the target mark a Stress."],
      ["Dread","Dark Army",8,"Spell",2,"Make a Spellcast Roll (14). Once per rest, on a success you can mark a Stress to summon a group of 8 fiends within Close range that move with you. Place a d8 on this card set to 8, representing the size of your army. Whenever you deal damage to a target within Close range, you can decrease this value by 1 to deal an additional 1d8 of physical damage. When you take damage, you can decrease this value by 1 to reduce the damage by 1d8. Each time the die is decreased, a fiend acts on your behalf, then disappears. When the die's value would be reduced below 1, return this card to your vault. Otherwise, at your next rest, the die is cleared."],
      ["Midnight","Dark Whispers",6,"Spell",0,"You can speak into the mind of any person with whom you've made physical contact. Once you've opened a channel with them, they can speak back into your mind. Additionally, you can mark a Stress to make a Spellcast Roll against them. On a success, you can ask the GM one of the following questions and receive an answer:\n• Where are they?\n• What are they doing?\n• What are they afraid of?\n• What do they cherish most in the world?"],
      ["Blade","Deadly Focus",4,"Ability",2,"Once per rest, you can apply all your focus toward a target of your choice. Until you attack another creature, you defeat the target, or the battle ends, gain a +1 bonus to your Proficiency."],
      ["Sage","Death Grip",4,"Spell",1,"Make a Spellcast Roll against a target within Close range and choose one of the following options:\n• You pull the target into Melee range or pull yourself into Melee range of them.\n• You constrict the target and force them to mark 2 Stress.\n• All adversaries between you and the target must succeed on a Reaction Roll (13) or be hit by vines, taking 3d6+2 physical damage.\nOn a success, vines reach out from your hands, causing the chosen effect and temporarily Restraining the target."],
      ["Bone","Deathrun",10,"Ability",1,"Spend 3 Hope to run a straight path through the battlefield to a point within Far range, making an attack against all adversaries within your weapon's range along that path. Choose the order in which you deal damage to the targets you succeeded against. For the first, roll your weapon damage with a +1 bonus to your Proficiency. Then remove a die from your damage roll and deal the remaining damage to the next target. Continue to remove a die for each subsequent target until you have no more damage dice or adversaries.\nYou can't target the same adversary more than once per attack."],
      ["Grace","Deft Deceiver",1,"Ability",0,"Spend a Hope to gain advantage on a roll to deceive or trick someone into believing a lie you tell them."],
      ["Bone","Deft Maneuvers",1,"Ability",0,"Once per rest, mark a Stress to sprint anywhere within Far range without making an Agility Roll to get there.\nIf you end this movement within Melee range of an adversary and immediately make an attack against them, gain a +1 bonus to the attack roll."],
      ["Dread","Dire Strike",5,"Spell",1,"Spend a Hope to summon pure dark energy that consumes your weapon until your next rest. When you make an attack in melee range with this weapon, use your Spellcast trait instead of the trait it calls for. On a success, roll a number of d8 equal to the current number of Fear the GM has up to your level and deal that much damage as your adversary feels cold terror seep into their wound. If you succeed with Fear, the target must also mark a Stress."],
      ["Codex","Disintegration Wave",9,"Spell",4,"Make a Spellcast Roll (18). Once per long rest on a success, the GM tells you which adversaries within Far range have a Difficulty of 18 or lower. Mark a Stress for each one you wish to hit with this spell. They are killed and can't come back to life by any means."],
      ["Splendor","Divination",4,"Spell",1,"Once per long rest, spend 3 Hope to reach out to the forces beyond and ask one \"yes or no\" question about an event, person, place, or situation in the near future. For a moment, the present falls away and you see the answer before you."],
      ["Dread","Dread-Touched",7,"Spell",2,"When 4 or more of the domain cards in your loadout are from the Dread domain, gain the following benefits:\n* When you succeed with Fear, you can mark 2 Stress to keep the GM from gaining a Fear.\n* Once per short rest, when making an action roll, you can add a +1 bonus to the roll for each Fear token the GM has stored."],
      ["Arcana","Earthquake",9,"Spell",2,"Make a Spellcast Roll (16). Once per rest on a success, all targets within Very Far range who aren't flying must make a Reaction Roll (18). Targets who fail take 3d10+8 physical damage and are temporarily Vulnerable. Targets who succeed take half damage.\nAdditionally, when you succeed on the Spellcast Roll, all terrain within Very Far range becomes difficult to move through and structures within this range might sustain damage or crumble."],
      ["Midnight","Eclipse",10,"Spell",2,"Make a Spellcast Roll (16). Once per long rest on a success, plunge the entire area within Far range into complete darkness only you and your allies can see through. Attack rolls have disadvantage when targeting you or an ally within this shadow. Additionally, when you or an ally succeeds with Hope against an adversary within this shadow, the target must mark a Stress.\nThis spell lasts until the GM spends a Fear on their turn to clear this effect or you take Severe damage."],
      ["Dread","Eldritch Flesh",8,"Spell",1,"You embody the darkness you have dallied with. While this card is active in your loadout:\n* For every 2 Stress you have marked, increase your damage thresholds by +1.\n* Whenever you succeed with Fear on an action roll, you can spend a Hope to clear an Armor slot."],
      ["Grace","Encore",10,"Spell",1,"When an ally within Close range deals damage to an adversary, you can make a Spellcast Roll against that same target. On a success, you deal the same damage to the target that your ally dealt. If your Spellcast Roll succeeds with Fear, place this card in your vault."],
      ["Grace","Endless Charisma",7,"Ability",1,"After you make an action roll to persuade, lie, or garner favor, you can spend a Hope to reroll the Hope or Fear Die."],
      ["Grace","Enrapture",1,"Spell",0,"Make a Spellcast Roll against a target within Close range.\nOn a success, they become temporarily Enraptured. While Enraptured, a target's attention is fixed on you, narrowing their field of view and drowning out any sound but your voice. Once per rest on a success, you can mark a Stress to force the Enraptured target to mark a Stress as well."],
      ["Arcana","Falling Sky",10,"Spell",1,"Make a Spellcast Roll against all adversaries within Far range. Mark any number of Stress to make shards of arcana rain down from above. Targets you succeed against take 1d20+2 magic damage for each Stress marked."],
      ["Sage","Fane Of The Wilds",9,"Ability",2,"After a long rest, place a number of tokens equal to the number of Sage domain cards in your loadout and vault on this card.\nWhen you would make a Spellcast Roll, you can spend any number of tokens after the roll to gain a +1 bonus for each token spent.\nWhen you critically succeed on a Spellcast Roll for a Sage domain spell, gain a token.\nWhen you take a long rest, clear all unspent tokens."],
      ["Bone","Ferocity",2,"Ability",2,"When you cause an adversary to mark 1 or more Hit Points, you can spend 2 Hope to increase your Evasion by the number of Hit Points they marked. This bonus lasts until after the next attack made against you."],
      ["Splendor","Final Words",2,"Spell",1,"You can infuse a corpse with a moment of life to speak with it. Make a Spellcast Roll (13). On a success with Hope, the corpse answers up to three questions. On a success with Fear, the corpse answers one question. The corpse answers truthfully, but it can't impart information it didn't know in life. On a failure, or once the corpse has finished answering your questions, the body turns to dust."],
      ["Arcana","Flight",3,"Spell",1,"Make a Spellcast Roll (15). On a success, place a number of tokens equal to your Agility on this card (minimum 1). When you make an action roll while flying, spend a token from this card. After the action that spends the last token is resolved, you descend to the ground directly below you."],
      ["Arcana","Floating Eye",2,"Spell",0,"Spend a Hope to create a single, small floating orb that you can move anywhere within Very Far range. While this spell is active, you can see through the orb as though you're looking out from its position. You can transition between using your own senses and seeing through the orb freely. If the orb takes damage or moves out of range, the spell ends."],
      ["Sage","Forager",6,"Ability",1,"As an additional downtime move you can choose, roll a d6 to see what you forage. Work with the GM to describe it and add it to your inventory as a consumable. Your party can carry up to five foraged consumables at a time.\n1. A unique food (Clear 2 Stress)\n2. A beautiful relic (Gain 2 Hope)\n3. An arcane rune (+2 to a Spellcast Roll)\n4. A healing vial (Clear 2 Hit Points)\n5. A luck charm (Reroll any die)\n6. Choose one of the options above."],
      ["Sage","Force Of Nature",10,"Spell",2,"Mark a Stress to transform into a hulking nature spirit, gaining the following benefits:\n• When you succeed on an attack or Spellcast Roll, gain a +10 bonus to the damage roll.\n• When you deal enough damage to defeat a creature within Close range, you absorb them and clear an Armor Slot.\n• You can't be Restrained.\nBefore you make an action roll, you must spend a Hope. If you can't, you revert to your normal form."],
      ["Valor","Forceful Push",1,"Ability",0,"Make an attack with your primary weapon against a target within Melee range. On a success, you deal damage and knock them back to Close range. On a success with Hope, add a d6 to your damage roll.\nAdditionally, you can spend a Hope to make them temporarily Vulnerable."],
      ["Sage","Forest Sprites",8,"Spell",2,"Make a Spellcast Roll (13). On a success, spend any number of Hope to create an equal number of small forest sprites who appear at points you choose within Far range, providing the following benefits:\n• Your allies gain a +3 bonus to attack rolls against adversaries within Melee range of a sprite.\n• An ally who marks an Armor Slot while within Melee range of a sprite can mark an additional Armor Slot.\nA sprite vanishes after granting a benefit or taking any damage."],
      ["Blade","Fortified Armor",4,"Ability",0,"While you are wearing armor, gain a +2 bonus to your damage thresholds."],
      ["Blade","Frenzy",8,"Ability",3,"Once per long rest, you can go into a Frenzy until there are no more adversaries within sight.\nWhile Frenzied, you can't use Armor Slots, and you gain a +10 bonus to your damage rolls and a +8 bonus to your Severe damage threshold."],
      ["Valor","Full Surge",8,"Ability",1,"Once per long rest, mark 3 Stress to push your body to its limits. Gain a +2 bonus to all of your character traits until your next rest."],
      ["Blade","Get Back Up",1,"Ability",1,"When you take Severe damage, you can mark a Stress to reduce the severity by one threshold."],
      ["Sage","Gifted Tracker",1,"Ability",0,"When you're tracking a specific creature or group of creatures based on signs of their passage, you can spend any number of Hope and ask the GM that many questions from the following list.\n• What direction did they go?\n• How long ago did they pass through?\n• What were they doing in this location?\n• How many of them were here?\nWhen you encounter creatures you've tracked in this way, gain a +1 bonus to your Evasion against them."],
      ["Blade","Glancing Blow",7,"Ability",1,"When you fail an attack, you can mark a Stress to deal weapon damage using half your Proficiency."],
      ["Blood","Glyph Of Hemorrhaging",9,"Spell",1,"Make a Spellcast Roll against a creature within Far range. On a success, mark a Hit Point to sear the target with a magical glyph that lasts until the GM spends 2 Fear to remove it or you take Severe damage. Whenever the target marks any Hit Points while the glyph remains, you can mark a Stress to make them mark an additional Hit Point."],
      ["Midnight","Glyph Of Nightfall",4,"Spell",1,"Make a Spellcast Roll against a target within Very Close range. On a success, spend a Hope to conjure a dark glyph upon their body that exposes their weak points, temporarily reducing the target's Difficulty by a value equal to your Knowledge (minimum 1)."],
      ["Valor","Goad Them On",4,"Ability",1,"Describe how you taunt a target within Close range, then make a Presence Roll against them. On a success, the target must mark a Stress, and the next time the GM spotlights them, they must target you with an attack, which they make with disadvantage."],
      ["Blade","Gore And Glory",9,"Ability",2,"When you critically succeed on a weapon attack, gain an additional Hope or clear an additional Stress. Additionally, when you deal enough damage to defeat an enemy, gain a Hope or clear a Stress."],
      ["Grace","Grace-Touched",7,"Ability",2,"When 4 or more of the domain cards in your loadout are from the Grace domain, gain the following benefits:\n• You can mark an Armor Slot instead of marking a Stress.\n• When you would force a target to mark a number of Hit Points, you can choose instead to force them to mark that number of Stress."],
      ["Blood","Grisly Harpoon",4,"Spell",1,"You launch a harpoon of blood at a location or creature within Far range. If the target is a location, make a Spellcast Roll (13). On a success, mark a Stress to pull yourself to a position within Melee range of it.\nIf the target is a creature, make a Spellcast Roll against it. On a success, mark a Stress to deal 3d8 magic damage to the target. You then pull the target straight toward yourself or pull yourself straight toward the target, ending within Melee range of each other."],
      ["Valor","Ground Pound",8,"Ability",2,"Spend 2 Hope to strike the ground where you stand and make a Strength Roll against all targets within Very Close range. Targets you succeed against are thrown back to Far range and must make a Reaction Roll (17). Targets who fail take 4d10+8 damage. Targets who succeed take half damage."],
      ["Sage","Healing Field",4,"Spell",2,"Once per long rest, you can conjure a field of healing plants around you. Everywhere within Close range of you bursts to life with vibrant nature, allowing you and all allies in the area to clear a Hit Point.\nSpend 2 Hope to allow you and all allies to clear 2 Hit Points instead."],
      ["Splendor","Healing Hands",2,"Spell",1,"Make a Spellcast Roll (13) and target a creature other than yourself within Melee range. On a success, mark a Stress to clear 2 Hit Points or 2 Stress on the target. On a failure, mark a Stress to clear a Hit Point or a Stress on the target. You can't heal the same target again until your next long rest."],
      ["Splendor","Healing Strike",7,"Spell",1,"When you deal damage to an adversary, you can spend 2 Hope to clear a Hit Point on an ally within Close range."],
      ["Dread","Hideous Retribution",2,"Spell",2,"When an ally within Close range takes damage from a target you can see, you can make a Reaction Roll against the target. On a success, mark a Stress to deal them d6 magic damage using your Proficiency."],
      ["Valor","Hold The Line",9,"Ability",1,"Describe the defensive stance you take and spend a Hope. If an adversary moves within Very Close range, they're pulled into Melee range and Restrained.\nThis condition lasts until you move or fail a roll with Fear, or the GM spends 2 Fear on their turn to clear it."],
      ["Midnight","Hush",5,"Spell",1,"Make a Spellcast Roll against a target within Close range. On a success, spend a Hope to conjure suppressive magic around the target that encompasses everything within Very Close range of them and follows them as they move.\nThe target and anything within the area is Silenced until the GM spends a Fear on their turn to clear this condition, you cast Hush again, or you take Major damage. While Silenced, they can't make noise and can't cast spells."],
      ["Grace","Hypnotic Shimmer",3,"Spell",1,"Make a Spellcast Roll against all adversaries in front of you within Close range. Once per rest on a success, create an illusion of flashing colors and lights that temporarily Stuns targets you succeed against and forces them to mark a Stress. While Stunned, they can't use reactions and can't take any other actions until they clear this condition."],
      ["Valor","I Am Your Shield",1,"Ability",1,"When an ally within Very Close range would take damage, you can mark a Stress to stand in the way and make yourself the target of the attack instead. When you take damage from this attack, you can mark any number of Armor Slots."],
      ["Bone","I See It Coming",1,"Ability",1,"When you're targeted by an attack made from beyond Melee range, you can mark a Stress to roll a d4 and gain a bonus to your Evasion equal to the result against the attack."],
      ["Valor","Inevitable",6,"Ability",1,"When you fail an action roll, your next action roll has advantage."],
      ["Grace","Inspirational Words",1,"Ability",1,"Your speech is imbued with power. After a long rest, place a number of tokens on this card equal to your Presence. When you speak with an ally, you can spend a token from this card to give them one benefit from the following options:\n• Your ally clears a Stress.\n• Your ally clears a Hit Point.\n• Your ally gains a Hope.\nWhen you take a long rest, clear all unspent tokens."],
      ["Splendor","Invigoration",10,"Spell",3,"When you or an ally within Close range has used a feature that has an exhaustion limit (such as once per rest or once per session), you can spend any number of Hope and roll that many d6s. If any roll a 6, the feature can be used again."],
      ["Grace","Invisibility",3,"Spell",1,"Make a Spellcast Roll (10). On a success, mark a Stress and choose yourself or an ally within Melee range to become Invisible. An Invisible creature can't be seen except through magical means and attack rolls against them are made with disadvantage. Place a number of tokens equal to your Spellcast trait on this card. When the Invisible creature takes an action, spend a token from this card. After the action that spends the last token is resolved, the effect ends.\nYou can only hold Invisibility on one creature at a time."],
      ["Dread","Invoke Torment",10,"Spell",2,"When you deal damage to a creature that has all of its Stress marked, you deal double damage. If this defeats them, you can clear a Stress. If it doesn't defeat them, they are permanently Vulnerable."],
      ["Bone","Know Thy Enemy",5,"Ability",1,"When observing a creature, you can make an Instinct Roll against them. On a success, spend a Hope and ask the GM for one set of information about the target from the following options:\n• Their unmarked Hit Points and Stress.\n• Their Difficulty and damage thresholds.\n• Their tactics and standard attack damage dice.\n• Their features and Experiences.\nAdditionally on a success, you can mark a Stress to remove a Fear from the GM's Fear Pool."],
      ["Valor","Lead By Example",9,"Ability",3,"When you deal damage to an adversary, you can mark a Stress and describe how you encourage your allies. The next PC to make an attack against that adversary can clear a Stress or gain a Hope."],
      ["Valor","Lean On Me",3,"Ability",1,"Once per long rest, when you console or inspire an ally who failed an action roll, you can both clear 2 Stress."],
      ["Blood","Life Leash",8,"Spell",2,"Spend a Hope to allow yourself and a willing ally within Far range to redistribute marked Hit Points between the two of you. You then can't target that ally again with Life Leash until you finish a rest."],
      ["Splendor","Life Ward",4,"Spell",1,"Spend 3 Hope and choose an ally within Close range. They are marked with a glowing sigil of protection. When this ally would make a death move, they clear a Hit Point instead.\nThis effect ends when it saves the target from a death move, you cast Life Ward on another target, or you take a long rest."],
      ["Blood","Lifeblood Talisman",1,"Spell",0,"Mark a Hit Point to conjure a talisman infused with your life essence. The talisman appears in your hand, and whoever carries the talisman gains its benefit: Whenever the talisman's bearer marks 2 or more Hit Points, they can spend a Hope to reduce the number of Hit Points marked by 1. The talisman disappears if you have no Hit Points marked or you use this spell again."],
      ["Codex","Manifest Wall",5,"Spell",2,"Make a Spellcast Roll (15). Once per rest on a success, spend a Hope to create a temporary magical wall between two points within Far range. It can be up to 50 feet high and form at any angle. Creatures or objects in its path are shunted to a side of your choice. The wall stays up until your next rest or you cast Manifest Wall again."],
      ["Midnight","Mass Disguise",6,"Spell",0,"When you have a few minutes of silence to focus, you can mark a Stress to change the appearance of all willing creatures within Close range. Their new forms must share a general body structure and size, and can be somebody or something you've seen before or entirely fabricated. A disguised creature has advantage on Presence Rolls to avoid scrutiny.\nActivate a Countdown (8). It ticks down as a consequence the GM chooses. When it triggers, the disguise drops."],
      ["Grace","Mass Enrapture",8,"Spell",3,"Make a Spellcast Roll against all targets within Far range. Targets you succeed against become temporarily Enraptured. While Enraptured, a target's attention is fixed on you, narrowing their field of view and drowning out any sound but your voice. Mark a Stress to force all Enraptured targets to mark a Stress, ending this spell."],
      ["Grace","Master Of The Craft",9,"Ability",0,"Gain a permanent +2 bonus to two of your Experiences or a permanent +3 bonus to one of your Experiences. Then place this card in your vault permanently."],
      ["Splendor","Mending Touch",1,"Spell",1,"You lay your hands upon a creature and channel healing magic to close their wounds. When you can take a few minutes to focus on the target you're helping, you can spend 2 Hope to clear a Hit Point or a Stress on them.\nOnce per long rest, when you spend this healing time learning something new about them or revealing something about yourself, you can clear 2 Hit Points or 2 Stress on them instead."],
      ["Midnight","Midnight Spirit",2,"Spell",1,"Spend a Hope to summon a humanoid-sized spirit that can move or carry things for you until your next rest.\nYou can also send it to attack an adversary. When you do, make a Spellcast Roll against a target within Very Far range. On a success, the spirit moves into Melee range with that target. Roll a number of d6s equal to your Spellcast trait and deal that much magic damage to the target. The spirit then dissipates. You can only have one spirit at a time."],
      ["Midnight","Midnight-Touched",7,"Ability",2,"When 4 or more of the domain cards in your loadout are from the Midnight domain, gain the following benefits:\n• Once per rest, when you have 0 Hope and the GM would gain a Fear, you can gain a Hope instead.\n• When you make a successful attack, you can mark a Stress to add the result of your Fear Die to your damage roll."],
      ["Blood","Mutual Suffering",5,"Spell",1,"When an attack from a creature causes you to mark one or more Hit Points, you can make a Reaction Roll using your Spellcast trait against the creature. On a success, the creature marks the same number of Hit Points as you did, and you can't use this spell again until you finish a rest."],
      ["Sage","Natural Familiar",2,"Spell",1,"Spend a Hope to summon a small nature spirit or forest critter to your side until your next rest, you cast Natural Familiar again, or the familiar is targeted by an attack. If you spend an additional Hope, you can summon a familiar that flies. You can communicate with them, make a Spellcast Roll to command them to perform simple tasks, and mark a Stress to see through their eyes.\nWhen you deal damage to an adversary within Melee range of your familiar, you add a d6 to your damage roll."],
      ["Sage","Nature's Tongue",1,"Ability",0,"You can speak the language of the natural world. When you want to speak to the plants and animals around you, make an Instinct Roll (12). On a success, they'll give you the information they know. On a roll with Fear, their knowledge might be limited or come at a cost.\nAdditionally, before you make a Spellcast Roll while within a natural environment, you can spend a Hope to gain a +2 bonus to the roll."],
      ["Dread","Nether Flames",6,"Spell",2,"Make a Spellcast Roll against all adversaries within Close range. You can spend a Hope for any you succeed against, and they must make a Reaction Roll (14). On a failure, they take d8+6 magic damage using your Proficiency as they are engulfed in dark fire. On a success, they take half damage."],
      ["Grace","Never Upstaged",6,"Ability",2,"When you mark 1 or more Hit Points from an attack, you can mark a Stress to place a number of tokens equal to the number of Hit Points you marked on this card. On your next successful attack, gain a +5 bonus to your damage roll for each token on this card, then clear all tokens."],
      ["Midnight","Night Terror",9,"Spell",2,"Once per long rest, choose any targets within Very Close range to perceive you as a nightmarish horror. The targets must succeed on a Reaction Roll (16) or become temporarily Horrified. While Horrified, they're Vulnerable. Steal a number of Fear from the GM equal to the number of targets that are Horrified (up to the number of Fear in the GM's pool). Roll a number of d6s equal to the number of stolen Fear and deal the total damage to each Horrified target. Discard the stolen Fear."],
      ["Blade","Not Good Enough",1,"Ability",1,"When you roll your damage dice, you can reroll any 1s or 2s."],
      ["Grace","Notorious",10,"Ability",0,"People know who you are and what you've done, and they treat you differently because of it. When you leverage your notoriety to get what you want, you can mark a Stress before you roll to gain a +10 bonus to the result. Your food and drinks are always free wherever you go, and everything else you buy is reduced in price by one bag of gold (to a minimum of one handful). This card doesn't count against your loadout's domain card maximum of 5 and can't be placed in your vault."],
      ["Bone","On The Brink",9,"Ability",1,"When you have 2 or fewer Hit Points unmarked, you don't take Minor damage."],
      ["Blade","Onslaught",10,"Ability",3,"When you successfully make an attack with your weapon, you never deal damage beneath a target's Major damage threshold (the target always marks a minimum of 2 Hit Points). Additionally, when a creature within your weapon's range deals damage to an ally with an attack that doesn't include you, you can mark a Stress to force them to make a Reaction Roll (15). On a failure, the target must mark a Hit Point."],
      ["Splendor","Overwhelming Aura",9,"Spell",2,"Make a Spellcast Roll (15) to magically empower your aura. On a success, spend 2 Hope to make your Presence equal to your Spellcast trait until your next long rest.\nWhile this spell is active, an adversary must mark a Stress when they target you with an attack."],
      ["Blood","Parasite Of The Will",5,"Spell",1,"Make a Spellcast Roll against a creature within Very Far range. On a success, mark a Hit Point to conjure a tiny magical bloodworm that burrows into the target. On a success with Hope, the target isn't aware of the worm within.\nYou have advantage on any Presence roll against the target, and whenever they make a roll, you can spend a Hope to give the roll disadvantage. You can destroy the bloodworm to cause the target to mark a Hit Point."],
      ["Midnight","Phantom Retreat",5,"Spell",2,"Spend a Hope to activate Phantom Retreat where you're currently standing. Spend another Hope at any time before your next rest to disappear from where you are and reappear where you were standing when you activated Phantom Retreat. This spell ends after you reappear."],
      ["Midnight","Pick And Pull",1,"Ability",0,"You have advantage on action rolls to pick nonmagical locks, disarm nonmagical traps, or steal items from a target (either through stealth or by force)."],
      ["Sage","Plant Dominion",9,"Spell",1,"Make a Spellcast Roll (18). Once per long rest on a success, you reshape the natural world, changing the surrounding plant life anywhere within Far range of you. For example, you can grow trees instantly, clear a path through dense vines, or create a wall of roots."],
      ["Blood","Power Through Pain",1,"Ability",1,"If you have at least one Hit Point marked, you gain a bonus to your damage rolls. The bonus equals twice your number of marked Hit Points."],
      ["Arcana","Premonition",5,"Spell",2,"You can channel arcane energy to have visions of the future. Once per long rest, immediately after the GM conveys the consequences of a roll you made, you can rescind the move and consequences like they never happened and make another move instead."],
      ["Arcana","Preservation Blast",4,"Spell",2,"Make a Spellcast Roll against all targets within Melee range. Targets you succeed against are forced back to Far range and take d8+3 magic damage using your Spellcast trait."],
      ["Blade","Rage Up",6,"Ability",1,"Before you make an attack, you can mark a Stress to gain a bonus to your damage roll equal to twice your Strength. You can Rage Up twice per attack."],
      ["Midnight","Rain Of Blades",1,"Spell",1,"Spend a Hope to make a Spellcast Roll and conjure throwing blades that strike out at all targets within Very Close range. Targets you succeed against take d8+2 magic damage using your Proficiency.\nIf a target you hit is Vulnerable, they take an extra 1d8 damage."],
      ["Bone","Rapid Riposte",6,"Ability",0,"When an attack made against you from within Melee range fails, you can mark a Stress and seize the opportunity to deal the weapon damage of one of your active weapons to the attacker."],
      ["Blade","Reaper's Strike",9,"Ability",3,"Once per long rest, spend a Hope to make an attack roll. The GM tells you which targets within range it would succeed against. Choose one of these targets and force them to mark 5 Hit Points."],
      ["Splendor","Reassurance",1,"Ability",0,"Once per rest, after an ally attempts an action roll but before the consequences take place, you can offer assistance or words of support. When you do, your ally can reroll their dice."],
      ["Blade","Reckless",2,"Ability",1,"Mark a Stress to gain advantage on an attack."],
      ["Bone","Recovery",6,"Ability",1,"During a short rest, you can choose a long rest downtime move instead. You can spend a Hope to let an ally do the same."],
      ["Bone","Redirect",4,"Ability",1,"When an attack made against you from beyond Melee range fails, roll a number of d6s equal to your Proficiency. If any roll a 6, you can mark a Stress to redirect the attack to damage an adversary within Very Close range instead."],
      ["Sage","Rejuvenation Barrier",8,"Spell",1,"Make a Spellcast Roll (15). Once per rest on a success, create a temporary barrier of protective energy around you at Very Close range. You and all allies within the barrier when this spell is cast clear 1d4 Hit Points. While the barrier is up, you and all allies within have resistance to physical damage from outside the barrier.\nWhen you move, the barrier follows you."],
      ["Splendor","Restoration",6,"Spell",2,"After a long rest, place a number of tokens equal to your Spellcast trait on this card. Touch a creature and spend any number of tokens to clear 2 Hit Points or 2 Stress for each token spent.\nYou can also spend a token from this card when touching a creature to clear the Vulnerable condition or heal a physical or magical ailment (the GM might require additional tokens depending on the strength of the ailment).\nWhen you take a long rest, clear all unspent tokens."],
      ["Splendor","Resurrection",10,"Spell",2,"Make a Spellcast Roll (20). On a success, restore one creature who has been dead no longer than 100 years to full strength. Then roll a d6. On a result of 5 or lower, place this card in your vault permanently.\nOn a failure, you can't cast Resurrection again for a week."],
      ["Arcana","Rift Walker",6,"Spell",2,"Make a Spellcast Roll (15). On a success, you place an arcane marking on the ground where you currently stand. The next time you successfully cast Rift Walker, a rift in space opens up, providing safe passage back to the exact spot where the marking was placed. This rift stays open until you choose to close it or you cast another spell.\nYou can drop the spell at any time to cast Rift Walker again and place the marking somewhere new."],
      ["Valor","Rise Up",6,"Ability",2,"Gain a bonus to your Severe threshold equal to your Proficiency.\nWhen you mark 1 or more Hit Points from an attack, clear a Stress."],
      ["Valor","Rousing Strike",5,"Ability",1,"Once per rest, when you critically succeed on an attack, you and all allies who can see or hear you can clear a Hit Point or 1d4 Stress."],
      ["Arcana","Rune Ward",1,"Spell",0,"You have a deeply personal trinket that can be infused with protective magic and held as a ward by you or an ally. Describe what it is and why it's important to you. The ward's holder can spend a Hope to reduce incoming damage by 1d8.\nIf the Ward Die result is 8, the ward's power ends after it reduces damage this turn. It can be recharged for free on your next rest."],
      ["Blood","Runic Adrenaline",8,"Ability",1,"Your practice of blood magic has seeped into your bloodstream, enhancing your vitals in moments of urgency. When you roll with advantage, use a d8 instead of a d6 as your advantage die if you have 1 or more Hit Points marked.\nAfter you make a Strength, an Agility, or a Finesse roll, you can mark a Hit Point to roll 1d8 and add it to the result."],
      ["Codex","Safe Haven",8,"Spell",3,"When you have a few minutes of calm to focus, you can spend 2 Hope to summon your Safe Haven, a large interdimensional home where you and your allies can take shelter. When you do, a magical door appears somewhere within Close range. Only creatures of your choice can enter. Once inside, you can make the entrance invisible. You and anyone else inside can always exit. Once you leave, the doorway must be summoned again. When you take a rest within your own Safe Haven, you can choose an additional downtime move."],
      ["Sage","Sage-Touched",7,"Ability",2,"When 4 or more of the domain cards in your loadout are from the Sage domain, gain the following benefits:\n• While you're in a natural environment, you gain a +2 bonus to your Spellcast Rolls.\n• Once per rest, you can double your Agility or Instinct when making a roll that uses that trait. You must choose to do this before you roll."],
      ["Splendor","Salvation Beam",9,"Spell",2,"Make a Spellcast Roll (16). On a success, mark any number of Stress to target a line of allies within Far range. You can clear Hit Points on the targets equal to the number of Stress marked, divided among them however you'd like."],
      ["Blood","Sanguine Feast",10,"Spell",2,"Make a Spellcast Roll against an adversary within Close range. On a success, spend 2 Hope to mark 1–3 Hit Points, and the target marks twice the number of the Hit Points you marked. If this causes the target to mark their last Hit Point, you can clear the Hit Points you marked to cast this spell."],
      ["Dread","Savor The Anguish",9,"Spell",0,"Whenever a creature within Close range marks any number of Stress or takes Severe damage, you can spend a Hope to clear a Stress or clear a Fear the GM holds."],
      ["Blade","Scramble",3,"Ability",1,"Once per rest, when a creature within Melee range would deal damage to you, you can avoid the attack and safely move out of Melee range of the enemy."],
      ["Splendor","Second Wind",3,"Ability",2,"Once per rest, when you succeed on an attack against an adversary, you can clear 3 Stress or a Hit Point. On a success with Hope, you also clear 3 Stress or a Hit Point on an ally within Close range of you."],
      ["Arcana","Sensory Projection",9,"Spell",0,"Once per rest, make a Spellcast Roll (15). On a success, drop into a vision that lets you clearly see and hear any place you have been before as though you are standing there in this moment. You can move freely in this vision and are not constrained by the physics or impediments of a physical body. This spell cannot be detected by mundane or magical means. You drop out of this vision upon taking damage or casting another spell."],
      ["Midnight","Shadowbind",2,"Spell",0,"Make a Spellcast Roll against all adversaries within Very Close range. Targets you succeed against are temporarily Restrained as their shadow binds them in place."],
      ["Midnight","Shadowhunter",8,"Ability",2,"Your prowess is enhanced under the cover of shadow. While you're shrouded in low light or darkness, you gain a +1 bonus to your Evasion and make attack rolls with advantage."],
      ["Splendor","Shape Material",5,"Spell",1,"Spend a Hope to shape a section of natural material you're touching (such as stone, ice, or wood) to suit your purpose. The area of the material can be no larger than you. For example, you can form a rudimentary tool or create a door. You can only affect the material within Close range of where you're touching it."],
      ["Grace","Share The Burden",6,"Spell",0,"Once per rest, take on the Stress from a willing creature within Melee range. The target describes what intimate knowledge or emotions telepathically leak from their mind in this moment between you. Transfer any number of their marked Stress to you, then gain a Hope for each Stress transferred."],
      ["Dread","Shared Trauma",3,"Spell",1,"Once per rest, you can redistribute any marked Hit Points between two willing targets you can touch."],
      ["Splendor","Shield Aura",8,"Spell",2,"Mark a Stress to cast a protective aura on a target within Very Close range. When the target marks an Armor Slot, they reduce the severity of the attack by an additional threshold. If this spell causes a creature who would be damaged to instead mark no Hit Points, the effect ends.\nYou can only hold Shield Aura on one creature at a time."],
      ["Valor","Shrug It Off",7,"Ability",1,"When you would take damage, you can mark a Stress to reduce the severity of the damage by one threshold. When you do, roll a d6. On a result of 3 or lower, place this card in your vault."],
      ["Codex","Sigil Of Retribution",6,"Spell",2,"Mark an adversary within Close range with a sigil of retribution. The GM gains a Fear. When the marked adversary deals damage to you or your allies, place a d8 on this card.\nYou can hold a number of d8s equal to your level. When you successfully attack the marked adversary, roll the dice on this card and add the total to your damage roll, then clear the dice. This effect ends when the marked adversary is defeated or you cast Sigil of Retribution again."],
      ["Bone","Signature Move",5,"Ability",1,"Name and describe your signature combat move. Once per rest, when you perform this signature move as part of an action you're taking, you can roll a d20 as your Hope Die. On a success, clear a Stress."],
      ["Dread","Siphon Essence",2,"Spell",1,"Make a Spellcast Roll against a target within Far range. On a success, once per short rest, the target takes d8 magic damage using your Proficiency and you clear 2 Hit Points. If you succeed with Fear, you clear 3 Hit Points."],
      ["Splendor","Smite",5,"Spell",2,"Once per rest, spend 3 Hope to charge your powerful smite. When you next successfully attack with a weapon, double the result of your damage roll. This attack deals magic damage regardless of the weapon's damage type."],
      ["Grace","Soothing Speech",4,"Ability",1,"During a short rest, when you take the time to comfort another character while using the Tend to Wounds downtime move on them, clear an additional Hit Point on that character. When you do, you also clear 2 Hit Points."],
      ["Midnight","Specter Of The Dark",10,"Spell",1,"Mark a Stress to become Spectral until you make an action roll targeting another creature. While Spectral, you're immune to physical damage and can float and pass through solid objects. Other creatures can still see you while you're in this form."],
      ["Dread","Spectral Mist",5,"Spell",0,"Make a Spellcasting Roll (13). On a success, spend a Hope to create an eerie mist that gathers around you and any targets within Close range. All affected creatures become momentarily incorporeal, allowing them to move through a solid wall. This effect lasts until you have passed through the wall successfully."],
      ["Midnight","Spellcharge",8,"Spell",1,"When you take magic damage, place tokens equal to the number of Hit Points you marked on this card. You can store a number of tokens equal to your Spellcast trait.\nWhen you make a successful attack against a target, you can spend any number of tokens to add a d6 for each token spent to your damage roll."],
      ["Splendor","Splendor-Touched",7,"Ability",2,"When 4 or more of the domain cards in your loadout are from the Splendor domain, gain the following benefits:\n• +3 bonus to your Severe damage threshold\n• Once per long rest, when incoming damage would require you to mark a number of Hit Points, you can choose to mark that much Stress or spend that much Hope instead."],
      ["Bone","Splintering Strike",9,"Ability",3,"Spend a Hope and make an attack against all adversaries within your weapon's range. Once per long rest, on a success against any targets, add up the damage dealt, then redistribute that damage however you wish between the targets you succeeded against. When you deal damage to a target, roll an additional damage die and add its result to the damage you deal to that target."],
      ["Midnight","Stealth Expertise",4,"Ability",0,"When you roll with Fear while attempting to move unnoticed through a dangerous area, you can mark a Stress to roll with Hope instead.\nIf an ally within Close range is also attempting to move unnoticed and rolls with Fear, you can mark a Stress to change their result to a roll with Hope."],
      ["Bone","Strategic Approach",2,"Ability",1,"After a long rest, place a number of tokens equal to your Knowledge on this card (minimum 1). The first time you move within Close range of an adversary and make an attack against them, you can spend one token to choose one of the following options:\n• You make the attack with advantage.\n• You clear a Stress on an ally within Melee range of the adversary.\n• You add a d8 to your damage roll.\nWhen you take a long rest, clear all unspent tokens."],
      ["Splendor","Stunning Sunlight",8,"Spell",2,"Make a Spellcast Roll to unleash powerful rays of burning sunlight against all adversaries in front of you within Far range. On a success, spend any number of Hope and force that many targets you succeeded against to make a Reaction Roll (14). Targets who succeed take 3d20+3 magic damage. Targets who fail take 4d20+5 magic damage and are temporarily Stunned. While Stunned, they can't use reactions and can't take any other actions until they clear this condition."],
      ["Dread","Summon Horror",4,"Spell",2,"Make a Spellcast Roll against a target within Far range. On a success, spend a Hope to call forth a large fiend or otherworldly creature to attack them and deal d10 magic damage using your Proficiency. The target must also make a Reaction Roll (12) to steel themselves from the horror. On a failure, they mark 1d4 Stress.\nAfter making the attack, the horror dissipates."],
      ["Valor","Support Tank",4,"Ability",2,"When an ally within Close range fails a roll, you can spend 2 Hope to allow them to reroll either their Hope or Fear Die."],
      ["Bone","Swift Step",10,"Ability",2,"When an attack made against you fails, clear a Stress. If you can't clear a Stress, gain a Hope."],
      ["Bone","Tactician",3,"Ability",1,"When you Help an Ally, they can spend a Hope to add one of your Experiences to their roll alongside your advantage die. When making a Tag Team Roll, you can roll a d20 as your Hope Die."],
      ["Arcana","Telekinesis",6,"Spell",0,"Make a Spellcast Roll against a target within Far range. On a success, you can use your mind to move them anywhere within Far range of their original position. You can throw the lifted target as an attack by making an additional Spellcast Roll against the second target you're trying to attack. On a success, deal d12+4 physical damage to the second target using your Proficiency. This spell then ends."],
      ["Codex","Teleport",5,"Spell",2,"Once per long rest, you can instantly teleport yourself and any number of willing targets within Close range to a place you've been before. Choose one of the following options, then make a Spellcast Roll (16):\n• If you know the place very well, gain a +3 bonus.\n• If you've visited the place frequently, gain a +1 bonus.\n• If you've visited the place infrequently, gain no modifier.\n• If you've only been there once, gain a −2 penalty.\nOn a success, you appear where you were intending to go. On a failure, you appear off course, with the range of failure determining how far off course."],
      ["Grace","Tell No Lies",2,"Spell",1,"Make a Spellcast Roll against a target within Very Close range. On a success, they can't lie to you while they remain within Close range, but they are not compelled to speak. If you ask them a question and they refuse to answer, they must mark a Stress and the effect ends. The target is typically unaware this spell has been cast on them until it causes them to utter the truth."],
      ["Sage","Tempest",10,"Spell",2,"Choose one of the following tempests and make a Spellcast Roll against all targets within Far range. Targets you succeed against experience its effects until the GM spends a Fear on their turn to end this spell.\n• Blizzard: Deal 2d20+8 magic damage and targets are temporarily Vulnerable.\n• Hurricane: Deal 3d10+10 magic damage and choose a direction the wind is blowing. Targets can't move against the wind.\n• Sandstorm: Deal 5d6+9 magic damage. Attacks made from beyond Melee range have disadvantage."],
      ["Dread","Terrify",3,"Spell",1,"Make a Spellcast Roll against a target within Far range. On a success, the target marks 1d4 Stress and you can choose to make the target run one range away from you (Close, to Far, Far to Very Far, etc.). You can also spend a Hope to make the target temporarily Vulnerable."],
      ["Sage","Thorn Skin",5,"Spell",1,"Once per rest, spend a Hope to sprout thorns all over your body. When you do, place a number of tokens equal to your Spellcast trait on this card. When you take damage, you can spend any number of tokens to roll that number of d6s. Add the results together and reduce the incoming damage by that amount. If you're within Melee range of the attacker, deal that amount of damage back to them.\nWhen you take a rest, clear all unspent tokens."],
      ["Grace","Thought Delver",5,"Spell",2,"You can peek into the minds of others. Spend a Hope to read the vague surface thoughts of a target within Far range. Make a Spellcast Roll against the target to delve for deeper, more hidden thoughts.\nOn a roll with Fear, the target might, at the GM's discretion, become aware that you're reading their thoughts."],
      ["Grace","Through Your Eyes",4,"Spell",1,"Choose a target within Very Far range. You can see through their eyes and hear through their ears. You can transition between using your own senses or the target's freely until you cast another spell or until your next rest."],
      ["Sage","Towering Stalk",3,"Spell",1,"Once per rest, you can conjure a thick, twisting stalk within Close range that can be easily climbed. Its height can grow up to Far range.\nMark a Stress to use this spell as an attack. Make a Spellcast Roll against an adversary or group of adversaries within Close range. The erupting stalk lifts targets you succeed against into the air and drops them, dealing d8 physical damage using your Proficiency."],
      ["Codex","Transcendent Union",10,"Spell",1,"Once per long rest, spend 5 Hope to cast this spell on two or more willing creatures. Until your next rest, when a creature connected by this union would mark Stress or Hit Points, the connected creatures can choose who marks it."],
      ["Grace","Troublemaker",2,"Ability",2,"When you taunt or provoke a target within Far range, make a Presence Roll against them. Once per rest on a success, roll a number of d4s equal to your Proficiency. The target must mark Stress equal to the highest result rolled."],
      ["Midnight","Twilight Toll",9,"Ability",1,"Choose a target within Far range. When you succeed on an action roll against them that doesn't result in making a damage roll, place a token on this card. When you deal damage to this target, spend any number of tokens to add a d12 for each token spent to your damage roll. You can only hold Twilight Toll on one creature at a time.\nWhen you choose a new target or take a rest, clear all unspent tokens."],
      ["Dread","Umbral Veil",1,"Spell",1,"Make a Spellcast Roll (10). On a success, spend any number of Hope and place an equal number of tokens on this card to encase yourself in shadowy energy. After an attack roll is made against you, you may spend any number of tokens to gain a +1 bonus to your Evasion per token against that attack."],
      ["Valor","Unbreakable",10,"Ability",4,"When you mark your last Hit Point, instead of making a death move, you can roll a d6 and clear a number of Hit Points equal to the result. Then place this card in your vault."],
      ["Midnight","Uncanny Disguise",1,"Spell",0,"When you have a few minutes to prepare, you can mark a Stress to don the facade of any humanoid you can picture clearly in your mind. While disguised, you have advantage on Presence Rolls to avoid scrutiny.\nPlace a number of tokens equal to your Spellcast trait on this card. When you take an action while disguised, spend a token from this card. After the action that spends the last token is resolved, the disguise drops."],
      ["Arcana","Unleash Chaos",1,"Spell",1,"At the beginning of a session, place a number of tokens equal to your Spellcast trait on this card.\nMake a Spellcast Roll against a target within Far range and spend any number of tokens to channel raw energy from within yourself to unleash against them. On a success, roll a number of d10s equal to the tokens you spent and deal that much magic damage to the target. Mark a Stress to replenish this card with tokens (up to your Spellcast trait).\nAt the end of each session, clear all unspent tokens."],
      ["Bone","Untouchable",1,"Ability",1,"Gain a bonus to your Evasion equal to half your Agility."],
      ["Valor","Unyielding Armor",10,"Ability",1,"When you would mark an Armor Slot, roll a number of d6s equal to your Proficiency. If any roll a 6, reduce the severity by one threshold without marking an Armor Slot."],
      ["Valor","Valor-Touched",7,"Ability",1,"When 4 or more of the domain cards in your loadout are from the Valor domain, gain the following benefits:\n• +1 bonus to your Armor Score\n• When you mark 1 or more Hit Points without marking an Armor Slot, clear an Armor Slot."],
      ["Blood","Vampiric Strike",7,"Spell",2,"When you make a successful attack roll against an adversary and cause them to mark 2 or more Hit Points, you can spend a Hope to clear a Hit Point or Stress."],
      ["Midnight","Vanishing Dodge",7,"Spell",1,"When an attack made against you that would deal physical damage fails, you can spend a Hope to envelop yourself in shadow, becoming Hidden and teleporting to a point within Close range of the attacker. You remain Hidden until the next time you make an action roll."],
      ["Midnight","Veil Of Night",3,"Spell",1,"Make a Spellcast Roll (13). On a success, you can create a temporary curtain of darkness between two points within Far range. Only you can see through this darkness. You're considered Hidden to adversaries on the other side of the veil, and you have advantage on attacks you make through the darkness. The veil remains until you cast another spell."],
      ["Blade","Versatile Fighter",3,"Ability",1,"You can use a different character trait for an equipped weapon, rather than the trait the weapon calls for.\nWhen you deal damage, you can mark a Stress to use the maximum result of one of your damage dice instead of rolling it."],
      ["Sage","Vicious Entangle",1,"Spell",1,"Make a Spellcast Roll against a target within Far range. On a success, roots and vines reach out from the ground, dealing 1d8+1 physical damage and temporarily Restraining the target. Additionally on a success, you can spend a Hope to temporarily Restrain another adversary within Very Close range of your target."],
      ["Blood","Vital Ward",6,"Spell",1,"Mark a Hit Point to trace a circle of blood around yourself at Very Close range. While in the circle, you have resistance to your choice of physical or magic damage (choose when you cast the spell). Allies also gain this benefit while in the circle. The circle disappears if you move out of it, mark 2 or more Hit Points, or cast this spell again."],
      ["Blade","Vitality",5,"Ability",0,"When you choose this card, permanently gain two of the following benefits:\n• One Stress slot\n• One Hit Point slot\n• +2 bonus to your damage thresholds\nThen place this card in your vault permanently."],
      ["Blood","Vitality Manipulation",2,"Spell",0,"Make a Spellcast Roll against a target within Very Close range. If you cast this on an ally, make the roll with advantage. On a success, mark a Stress, and choose one of the following effects:\n• The target grows calmer and clears a Stress. On a success with Hope, they clear 2 Stress.\n• The target grows more anxious and marks a Stress. On a success with Hope, they mark 2 Stress."],
      ["Dread","Voice Of Dread",1,"Spell",0,"You can magically speak directly into the ears of a creature you can see. To torment them with your words, make a Spellcast Roll against them. On a success, they must mark a Stress and become temporarily Vulnerable."],
      ["Splendor","Voice Of Reason",3,"Ability",1,"You speak with an unmatched power and authority. You have advantage on action rolls to de-escalate violent situations or convince someone to follow your lead.\nAdditionally, you're emboldened in moments of duress. When all of your Stress slots are marked, you gain a +1 bonus to your Proficiency for damage rolls."],
      ["Dread","Wailing Leap",6,"Spell",0,"Whenever you deal magic damage to a target, you can mark a Stress to immediately teleport into Melee with that creature."],
      ["Dread","Wall Of Hunger",7,"Spell",2,"Make a Spellcast Roll (13). On a success, you can create a visible wall of writhing, necrotic energy in a line between two points within Far range. This lasts until you mark your next Hit Point. Any creatures that are in the wall when it appears or pass through the wall mark 2 Stress, then must make a Reaction Roll (16). On a failure, they are temporarily Restrained by the wall."],
      ["Arcana","Wall Walk",1,"Spell",1,"Spend a Hope to allow a creature you can touch to climb on walls and ceilings as easily as walking on the ground. This lasts until the end of the scene or you cast Wall Walk again."],
      ["Blood","Weave The Flesh",4,"Spell",1,"Once per rest, mark a Hit Point to allow each ally within Close range to clear a Hit Point or a Stress. You can mark a Stress to allow those allies to clear one of each."],
      ["Blade","Whirlwind",1,"Ability",0,"Make an attack against a target within Very Close range. On a success, spend a Hope to use the attack against all other targets within Very Close range. All additional adversaries you succeed against with this ability take half damage."],
      ["Sage","Wild Fortress",5,"Spell",1,"Make a Spellcast Roll (13). On a success, spend 2 Hope to grow a natural barricade in the shape of a dome that you and one ally can take cover within. While inside the dome, a creature can't be targeted by attacks and can't make attacks. Attacks made against the dome automatically succeed. The dome has the following damage thresholds and lasts until it marks 3 Hit Points. Place tokens on this card to represent marking Hit Points.\nThresholds: 15/30"],
      ["Sage","Wild Surge",7,"Spell",2,"Once per long rest, mark a Stress to channel the natural world around you and enhance yourself. Describe how your appearance changes, then place a d6 on this card with the 1 value facing up.\nWhile the Wild Surge Die is active, you add its value to every action roll you make. After you add its value to a roll, increase the Wild Surge Die's value by one. When the die's value would exceed 6 or you take a rest, this form drops and you must mark an additional Stress."],
      ["Dread","Withering Affliction",4,"Spell",2,"Make a Spellcast Roll on a target within Far range. On a success, spend a Hope to make the target temporarily Withered. While Withered, any damage they deal is reduced by 1 Hit Point. You can only hold this spell on one creature at a time."],
      ["Grace","Words Of Discord",5,"Spell",1,"Whisper words of discord to an adversary within Melee range and make a Spellcast Roll (13). On a success, the target must mark a Stress and make an attack against another adversary instead of against you or your allies.\nOnce this attack is over, the target realizes what happened. The next time you cast Words of Discord on them, gain a −5 penalty to the Spellcast Roll."],
      ["Bone","Wrangle",8,"Ability",1,"Make an Agility Roll against all targets within Close range. Spend a Hope to move targets you succeed against, and any willing allies within Close range, to another point within Close range."],
      ["Splendor","Zone Of Protection",6,"Spell",2,"Make a Spellcast Roll (16). Once per long rest on a success, choose a point within Far range and create a visible zone of protection there for all allies within Very Close range of that point. When you do, place a d6 on this card with the 1 value facing up. When an ally in this zone takes damage, they reduce it by the die's value. You then increase the die's value by one. When the die's value would exceed 6, this effect ends."],
    ];

    for (const [domain, name, level, type, recall, desc] of domains) {
      cards.push({
        card_type: "domain", name: name as string, source: domain as string, content: desc as string,
        metadata: { level, type, recall_cost: recall, domain }
      });
    }

    // Batch insert
    const batchSize = 50;
    let inserted = 0;
    for (let i = 0; i < cards.length; i += batchSize) {
      const batch = cards.slice(i, i + batchSize);
      const { error } = await supabase.from("game_cards").insert(batch);
      if (error) {
        console.error(`Batch insert error at ${i}:`, error);
        return new Response(JSON.stringify({ error: error.message, inserted }), {
          status: 500, headers: { ...corsHeaders, "Content-Type": "application/json" }
        });
      }
      inserted += batch.length;
    }

    return new Response(JSON.stringify({ success: true, inserted }), {
      headers: { ...corsHeaders, "Content-Type": "application/json" }
    });
  } catch (err) {
    return new Response(JSON.stringify({ error: err.message }), {
      status: 500, headers: { ...corsHeaders, "Content-Type": "application/json" }
    });
  }
});
